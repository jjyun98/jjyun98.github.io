---
author: Jo YunHo
pubDatetime: 2022-10-16T00:00:00Z
modDatetime: 2022-10-16T00:00:00Z
title: 시계열 자료분석 - 불규칙, 추세성분, 주기성분의 이해 (6)
slug: "timeseries-components-transformation"
featured: false
draft: false
tags:
  - R
  - 시계열분석
description: "AirPassengers 데이터로 시계열 변환 기법과 확률보행과정 정상화 방법 학습"
---

## Table of contents

## 개요

시계열 데이터는 종종 **불균등한 분산**, **추세**, **계절성** 등의 비정상성을 보입니다. 이번 포스팅에서는 AirPassengers 데이터를 활용하여 **Box-Cox 변환**, **로그 변환** 등의 분산 안정화 기법과 **확률보행과정**의 정상화 방법을 알아보겠습니다.

## 1. 환경 설정

```r
library('tidyverse')
library('gridExtra')
library('forecast')
options(repr.plot.width = 6, repr.plot.height = 4)
```

## 2. AirPassengers 데이터 분석

### 데이터 로드 및 기본 확인

```r
data("AirPassengers")
z <- as.numeric(AirPassengers)
plot(z, type = 'l')
```

![AirPassengers 원본 데이터](@/assets/images/2022-10-16-시계열자료분석-학습6_files/2022-10-16-시계열자료분석-학습6_5_0.png)

**데이터 특성**: 
- 1949년~1960년 항공기 승객 수 (월별)
- 뚜렷한 **증가 추세**와 **계절성** 패턴
- 시간이 지날수록 **변동폭이 커지는** 특성 (분산 불안정)

### 다양한 변환 기법 적용

분산을 안정화하기 위해 여러 변환 기법을 적용해보겠습니다.

```r
tmp.dat <- tibble(
    t = seq.Date(as.Date("1949-01-01"),
                 by = 'month',
                 length.out = 144),
    original = z,
    log = log(z),
    sqrt = sqrt(z),
    Boxcox_0.15 = BoxCox(z, lambda = BoxCox.lambda(z, method = 'loglik'))
)

tmp.dat %>% head()
```

```
         t original      log     sqrt Boxcox_0.15
1 1949-01-01      112 4.718499 10.58301    6.863135
2 1949-02-01      118 4.770685 10.86278    6.969460
3 1949-03-01      132 4.882802 11.48913    7.200727
4 1949-04-01      129 4.859812 11.35782    7.152988
5 1949-05-01      121 4.795791 11.00000    7.020909
6 1949-06-01      135 4.905275 11.61895    7.247551
```

### Box-Cox 변환의 최적 λ 값

```r
BoxCox.lambda(z, method = 'loglik')  # 로그 우도 최대화 방법
```

```
[1] 0.15
```

```r
BoxCox.lambda(z)  # 기본 방법
```

```
[1] 0.110758
```

**λ 값 해석**:
- λ = 0.15 (로그 우도 최대화)
- λ ≈ 0 → 로그 변환과 유사한 효과
- λ = 1 → 원본 데이터 (변환 없음)
- λ = 0.5 → 제곱근 변환

### 변환 결과 비교 시각화

```r
par(mfrow=c(2,2))
plot(original ~ t, tmp.dat, type='l', main = "Original")
plot(log ~ t, tmp.dat, type='l', main = "log(z)")
plot(sqrt ~ t, tmp.dat, type='l', main = "sqrt(z)")
plot(Boxcox_0.15 ~ t, tmp.dat, type='l', main = "Boxcox_0.15")
graphics.off()
```

![변환 기법 비교](@/assets/images/2022-10-16-시계열자료분석-학습6_files/2022-10-16-시계열자료분석-학습6_11_0.png)

**변환 효과 분석**:
- **원본 데이터**: 시간이 지날수록 변동폭이 크게 증가
- **로그 변환**: 분산이 상당히 안정화됨, 승법적 계절성을 가법적으로 변환
- **제곱근 변환**: 중간 정도의 분산 안정화 효과
- **Box-Cox 변환**: 데이터에 최적화된 변환으로 가장 안정적인 분산

## 3. 확률보행과정 (Random Walk)

### 확률보행과정의 이해

확률보행과정은 $Z_t = Z_{t-1} + e_t$로 정의되며, 이는 비정상 AR(1) 과정입니다.

**누적합 형태**: $Z_t = e_t + e_{t-1} + e_{t-2} + ... + e_1$

### 확률보행과정 시뮬레이션

```r
e <- round(rnorm(10), 2)
cumsum(e)
```

```
[1] -0.02 -0.55  0.71  1.35  3.56  4.27  3.14  2.83  5.73  5.04
```

**소규모 예시**: 백색잡음의 누적합이 어떻게 확률보행을 형성하는지 보여줍니다.

### 대규모 확률보행과정 시뮬레이션

```r
e <- rnorm(1000)
par(mfrow=c(2,1))
plot(e, type='l', main = 'e : WN (White Noise)')
plot(cumsum(e), type='l', main='Random Walk')

z = cumsum(e)   # 확률보행
dz = diff(z)    # 1차 차분 → 백색잡음으로 복원
```

![확률보행과정 시뮬레이션](@/assets/images/2022-10-16-시계열자료분석-학습6_files/2022-10-16-시계열자료분석-학습6_14_1.png)

**핵심 관찰사항**:
- **상단 그래프**: 백색잡음 (정상과정) - 평균 주위에서 일정한 변동
- **하단 그래프**: 확률보행 (비정상과정) - 추세 없이 무작위로 방향 변경

## 4. 정상화 기법

### 차분을 통한 정상화

확률보행과정은 1차 차분을 통해 정상화할 수 있습니다:

**비정상 과정**: $Z_t = Z_{t-1} + e_t$  
**1차 차분**: $\nabla Z_t = Z_t - Z_{t-1} = e_t$ (백색잡음)

### 실제 데이터 적용

```r
# AirPassengers 데이터에 차분 적용
log_air <- log(AirPassengers)
diff_log_air <- diff(log_air)

# 시각화 비교
par(mfrow=c(2,1))
plot(log_air, main="로그 변환된 AirPassengers")
plot(diff_log_air, main="1차 차분된 로그 AirPassengers")
```

**정상화 과정**:
1. **로그 변환**: 분산 안정화
2. **1차 차분**: 추세 제거
3. **계절 차분**: 계절성 제거 (필요시)

## 5. 변환 기법 선택 가이드

### Box-Cox 변환 선택 기준

| λ 값 | 변환 형태 | 적용 상황 |
|------|-----------|-----------|
| λ = 1 | 원본 데이터 | 분산이 일정한 경우 |
| λ = 0.5 | 제곱근 변환 | 중간 정도의 분산 증가 |
| λ = 0 | 로그 변환 | 분산이 평균에 비례하여 증가 |
| λ < 0 | 역변환 | 분산이 평균보다 빠르게 증가 |

### 실무 적용 단계

1. **원본 데이터 시각화**: 분산 패턴, 추세, 계절성 파악
2. **분산 안정화**: Box-Cox, 로그, 제곱근 변환 중 선택
3. **추세 제거**: 차분 또는 추세 제거 기법 적용
4. **계절성 처리**: 계절 차분 또는 계절성 분해
5. **정상성 검정**: ADF, KPSS 검정으로 확인

### 변환 기법의 장단점

**로그 변환**:
- ✅ 승법적 구조를 가법적으로 변환
- ✅ 분산 안정화 효과 뛰어남
- ✅ 해석이 쉬움 (증가율 개념)
- ❌ 0 또는 음수 값에 적용 불가

**Box-Cox 변환**:
- ✅ 데이터에 최적화된 변환
- ✅ 다양한 분산 패턴에 적응
- ✅ λ를 자동으로 선택 가능
- ❌ 해석이 상대적으로 복잡

## 6. 정상성 진단

### 정상성 판별 방법

1. **시각적 진단**: 시계열 플롯에서 추세와 분산 변화 확인
2. **ACF/PACF 분석**: 정상 과정은 빠르게 감소, 비정상은 천천히 감소
3. **통계적 검정**: 
   - ADF 검정 (단위근 검정)
   - KPSS 검정 (정상성 검정)
4. **잔차 분석**: 변환 후 잔차의 백색잡음 성질 확인

### 차분 차수 결정

- **1차 차분**: 선형 추세 제거
- **2차 차분**: 이차 추세 제거 (과차분 주의)
- **계절 차분**: 계절 주기만큼의 차분 (예: 월별 데이터는 12차 차분)

## 마무리

시계열 데이터의 **분산 안정화**와 **정상화**는 적절한 모델링의 전제조건입니다. Box-Cox 변환, 로그 변환 등으로 분산을 안정화하고, 차분을 통해 추세를 제거함으로써 정상 시계열로 변환할 수 있습니다.

확률보행과정 예제를 통해 비정상 시계열이 차분으로 어떻게 정상화되는지 확인했으며, 실제 데이터에서도 이러한 기법들이 어떻게 적용되는지 살펴봤습니다.

다음 시간에는 **ARIMA 모델의 식별과 추정** 방법을 다뤄보겠습니다. 📊