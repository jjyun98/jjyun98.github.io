---
title:  "가상환경의 이해"
toc: true
tag: mac
---
jupyter환경, 패키지 설치

이 글의 내용은 전부 나 개인의 경험을 바탕으로 적어진 내용이기에 오류가 있을 수 있습니다.<br>
다만, 실사용만을 고려한다면, m1 mac유저에게는 유용할거라고 봅니다.

<br>

# jupyter 환경을 위한 가상환경

mac에서 가상환경을 만드는 대표적인 방법은 2가지가 있다.

> 1) pyenv<br>
> 2) conda

둘 다 각각의 장단점이 있는데, `pyenv`의 경우 좀 더 빠르고, 호환이 잘되며 오류도 더 적다.<br>
다만, 파이썬 용이라 jupyter환경에서 딥러닝이나 R을 사용하고자할 때, 처음부터 지원되는 `conda`에 비하면 제한되는 부분이 있을 수 있음. ex) pytorch GPU사용<br>

따라서 지금으로서는 `conda`를 사용하기를 권장한다.

<br>

## 실행 방법

실행 방법에는 두 가지 방법이 가능하다.

> 1) source<br>
> 2) conda

conda에서는 두 개 모두를 지원하지만, 호환성을 위해 conda를 사용하는 것을 권한다.<br>
물론 source가 내부에서 작동되는 것이기에 단축키가 잘 되고, 더 빠르긴하다.<br>
하지만, 차후 패키지와의 연동성까지 고려한다면, conda로 실행하기를 권한다.

<br>

## conda & pip

패키지를 설치함에 있어 사용하는 명령어 구문은 conda와 pip이 있다.
가장 큰 차이는 pip은 전역으로 설치되어, 가상환경 밖에도 영향을 미치고, conda의 경우는 반(half)전역으로 설치되어, 가상환경 밖에 반정도의 영향을 미친다.<br>

반 정도의 의미를 설명하려면 conda의 구조를 이해해야 하는데 아래와 같다.

- 이 그림은 저작권이 문제 있을 수 있으니 빠른 시일내 교체


![img](/assets/images/virtual_1218_1.png)

<br>

위에서 보이듯이 conda의 경우 패키지를 conda환경에 기본버젼을 설치하고, 각각의 가상환경에는 설정한 버젼에 맞게 제공하는 느낌이다.<br>
따라서 무조건 독립 환경이라고 할 수는 없으나 지금까지 conda로 인한 큰 문제는 발생하지 않았다.

pip의 경우 전역적으로 설치하기에 오류가 생길 가능성이 다분한데, 문제는 pip만을 지원하는 설치 패키지들이 있다. 이 경우 어떠한 패키지가 pip으로 설치하였는지 기억해 두는 것이 차후 오류에 대비해 좋을 듯하다. 

<br>

# 가상환경 구조에 의한 패키지 오류

패키지의 경우 오류가 생기는 case가 대표적으로 2가지 있다.

> 1) 경로가 2개 설정되는 경우<br>
> 2) 종속성 문제<br>
> 3) 버젼오류

사실 1번문제도 2번문제와 연결되어 있는 경우 많음.

## 해결 방법

1번의 경우, 애초에 설치시작이 중요하다.<br>
시작을 


```
conda create -n my_env r-4.2.0
```

요로코롬 가상환경 제작과 동시에 설치되게 진행하는 것이 좋다.(이래야 애초에 패키지 저장위치가 하나만 설정됨) 

python의 경우도 같음.

<br>

3번 문제의 경우도 위처럼 시작하면 어느정도 극복됨. 버젼은 최신버전에서 0.1 ~ 0.2 버전 아래 추천<br>
버젼 오류의 또 다른 경우는 패키지의 버젼이 맞지 않기 때문인데, 이 경우는 패키지와 python or R이 호환안되는 경우는 별로 없고, 종속적인 패키지들의 버젼이 호환이 안될 경우에 보통 이런 일이 발생한다. 이러한 경우에 가장 빠른 해결은 문제가 생기는 패키지들을 삭제한 뒤 전부 같은 호환되는 버젼에 맞추어 설치하는 방법을 추천한다.


```python
conda install autogluon=0.8.2
conda install autogluon.eda=0.8.2
```

<br>

### conda-forge란?

conda install을 하다보면 아래와 같이 conda-forge or 그냥 install만 하는 경우를 발견할 수 있다.


```python
conda install -c conda-forge autogluon=0.8.2
conda install autogluon=0.8.2
```

<br>

둘의 차이는 간단하다.
conda-forge의 경우 패키지 업데이트에 허락한다는 뜻이며, 그냥 install의 경우 그렇지 않는다는 의미이다.<br>
따라서, 위와 같이 패키지를 특정 버젼으로 설치하고자 하는 경우에는 conda-forge를 사용 안하는 것을 추천한다. 

<br>

# kernel

## IRkernel

사실 커널에 대한 이해가 부족하다.<br>
그래도 지금까지의 경험을 바탕으로 말하자면, irkernel은 설치하는 것이 좋다.
짧게 설명하면, IRkernel은 R언어를 jupyter Notebook과 같은 대화형 환경에서 사용할 수 있도록 하는 패키지이다. 설명은 이렇게 나와 있는데 경험상 python도 이 커널에서 하는 것이 더 좋다. 이유는 모른다.


설치 방법은 아래와 같고, `R`에 설치해야하며 python에서도 사용가능하다.<br>
먼저 R을 실행한다. 


```
install.packages('IRkernel') # IRkernel 설치
IRkernel::installspec # IRkernel을 Jupyter에 등록
```

<br>

다음 jupyter lab을 실행하주면 된다.

<br>

# 큰 문제 발생시

원인을 모르겠고, 해결이 어려운데 패키지 또는 설치파일들이 대혼란을 야기한다면, brew 패키지를 모두 날리기를 권한다.<br>
당연히, 모두 지우면 다시 전부 설정하게되어 좋은 방법은 아니지만, 확실하게 해결되는 방법 중 하나이며, 컴퓨터 전체를 포맷시키는 것도 아니기에 보통 하루 이내에서 복구 가능하다. 물론 이를 위해, 문제가 생길만한 프로그램이나 파일들은 brew로 설치하기를 권장한다.

