---
layout: single
title: "For Tidy Data"
categories:
    - R Syntax
tags: 
    - R
toc: true
toc_sticky: true
use_math: true
---

<head>
  <style>
    table.dataframe {
      white-space: normal;
      width: 100%;
      height: 240px;
      display: block;
      overflow: auto;
      font-family: Arial, sans-serif;
      font-size: 0.9rem;
      line-height: 20px;
      text-align: center;
      border: 0px !important;
    }

    table.dataframe th {
      text-align: center;
      font-weight: bold;
      padding: 8px;
    }

    table.dataframe td {
      text-align: center;
      padding: 8px;
    }

    table.dataframe tr:hover {
      background: #b8d1f3; 
    }

    .output_prompt {
      overflow: auto;
      font-size: 0.9rem;
      line-height: 1.45;
      border-radius: 0.3rem;
      -webkit-overflow-scrolling: touch;
      padding: 0.8rem;
      margin-top: 0;
      margin-bottom: 15px;
      font: 1rem Consolas, "Liberation Mono", Menlo, Courier, monospace;
      color: $code-text-color;
      border: solid 1px $border-color;
      border-radius: 0.3rem;
      word-break: normal;
      white-space: pre;
    }

  .dataframe tbody tr th:only-of-type {
      vertical-align: middle;
  }

  .dataframe tbody tr th {
      vertical-align: top;
  }

  .dataframe thead th {
      text-align: center !important;
      padding: 8px;
  }

  .page__content p {
      margin: 0 0 0px !important;
  }

  .page__content p > strong {
    font-size: 0.8rem !important;
  }

  </style>
</head>


# tidy data



pivot_longer, separate, unite, ê²°ì¸¡ê°’



```R
library('tidyverse')
```

## pivot


- ì–´ë–¤ í•­ëª©ì€ í–‰ìœ¼ë¡œ ì–´ë–¤ í•­ëª©ì€ ì—´ë¡œ ë³´ê³ ì ë‹¤ë£° ë•Œ ì‚¬ìš©


`-` table4a ì˜ˆì œ



```R
table4a
```

<table class="dataframe">
<caption>A tibble: 3 Ã— 3</caption>
<thead>
	<tr><th></th><th scope=col>country</th><th scope=col>1999</th><th scope=col>2000</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Afghanistan</td><td>   745</td><td>  2666</td></tr>
	<tr><th scope=row>2</th><td>Brazil     </td><td> 37737</td><td> 80488</td></tr>
	<tr><th scope=row>3</th><td>China      </td><td>212258</td><td>213766</td></tr>
</tbody>
</table>


`pivot_longer` : í–‰ì„ í•­ëª©ìœ¼ë¡œ ì¶”ê°€



```R
table4a %>%
pivot_longer(c('1999', '2000'), names_to = "year", values_to = "cases")
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 3</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>cases</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>   745</td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>  2666</td></tr>
	<tr><td>Brazil     </td><td>1999</td><td> 37737</td></tr>
	<tr><td>Brazil     </td><td>2000</td><td> 80488</td></tr>
	<tr><td>China      </td><td>1999</td><td>212258</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766</td></tr>
</tbody>
</table>



```R
table4a %>%
pivot_longer(c('1999','2000'), names_to = 'year', values_to = 'population')
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 3</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>population</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>   745</td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>  2666</td></tr>
	<tr><td>Brazil     </td><td>1999</td><td> 37737</td></tr>
	<tr><td>Brazil     </td><td>2000</td><td> 80488</td></tr>
	<tr><td>China      </td><td>1999</td><td>212258</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766</td></tr>
</tbody>
</table>


`-` ìœ„ì˜ ë‘ê°œ í•©ì³ì„œ ë³´ê¸°(mergeë‘ ë¹„ìŠ·í•œ ê¸°ëŠ¥ì¸ë“¯)



```R
tidy4a <- table4a %>%
pivot_longer(c('1999', '2000'), names_to = 'year', values_to = 'cases')
tidy4b <- table4b %>%
pivot_longer(c('1999', '2000'), names_to = 'year', values_to = 'population')
left_join(tidy4a, tidy4b)
```

<pre>
[1m[22mJoining, by = c("country", "year")
</pre>
<table class="dataframe">
<caption>A tibble: 6 Ã— 4</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>cases</th><th scope=col>population</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>   745</td><td>  19987071</td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>  2666</td><td>  20595360</td></tr>
	<tr><td>Brazil     </td><td>1999</td><td> 37737</td><td> 172006362</td></tr>
	<tr><td>Brazil     </td><td>2000</td><td> 80488</td><td> 174504898</td></tr>
	<tr><td>China      </td><td>1999</td><td>212258</td><td>1272915272</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766</td><td>1280428583</td></tr>
</tbody>
</table>


`-` table2 ì˜ˆì œ



```R
table2
```

<table class="dataframe">
<caption>A tibble: 12 Ã— 4</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>type</th><th scope=col>count</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>cases     </td><td>       745</td></tr>
	<tr><td>Afghanistan</td><td>1999</td><td>population</td><td>  19987071</td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>cases     </td><td>      2666</td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>population</td><td>  20595360</td></tr>
	<tr><td>Brazil     </td><td>1999</td><td>cases     </td><td>     37737</td></tr>
	<tr><td>Brazil     </td><td>1999</td><td>population</td><td> 172006362</td></tr>
	<tr><td>Brazil     </td><td>2000</td><td>cases     </td><td>     80488</td></tr>
	<tr><td>Brazil     </td><td>2000</td><td>population</td><td> 174504898</td></tr>
	<tr><td>China      </td><td>1999</td><td>cases     </td><td>    212258</td></tr>
	<tr><td>China      </td><td>1999</td><td>population</td><td>1272915272</td></tr>
	<tr><td>China      </td><td>2000</td><td>cases     </td><td>    213766</td></tr>
	<tr><td>China      </td><td>2000</td><td>population</td><td>1280428583</td></tr>
</tbody>
</table>


`pivot_wider` : `pivot_longer`ë‘ ë°˜ëŒ€ë¡œ í•­ëª©ì„ í–‰ìœ¼ë¡œ ë³´ë‚´ê¸°



```R
table2 %>%
pivot_wider(names_from = type, values_from = count)
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 4</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>cases</th><th scope=col>population</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>   745</td><td>  19987071</td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>  2666</td><td>  20595360</td></tr>
	<tr><td>Brazil     </td><td>1999</td><td> 37737</td><td> 172006362</td></tr>
	<tr><td>Brazil     </td><td>2000</td><td> 80488</td><td> 174504898</td></tr>
	<tr><td>China      </td><td>1999</td><td>212258</td><td>1272915272</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766</td><td>1280428583</td></tr>
</tbody>
</table>


> ê²°ê³¼ì ìœ¼ë¡œ `pivot_longer`ì€ ë„’ì€ í…Œì´ë¸”ì„ ë” ì¢ê³  ê¸¸ê²Œ ë§Œë“¤ê³ <br>

`pivot_wider`ëŠ” ê¸´ í…Œì´ë¸”ì„ ë” ì§§ê³  ë„“ê²Œ ë§Œë“ ë‹¤.


`-` table3 ì˜ˆì œ



```R
table3
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 3</caption>
<thead>
	<tr><th></th><th scope=col>country</th><th scope=col>year</th><th scope=col>rate</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Afghanistan</td><td>1999</td><td>745/19987071     </td></tr>
	<tr><th scope=row>2</th><td>Afghanistan</td><td>2000</td><td>2666/20595360    </td></tr>
	<tr><th scope=row>3</th><td>Brazil     </td><td>1999</td><td>37737/172006362  </td></tr>
	<tr><th scope=row>4</th><td>Brazil     </td><td>2000</td><td>80488/174504898  </td></tr>
	<tr><th scope=row>5</th><td>China      </td><td>1999</td><td>212258/1272915272</td></tr>
	<tr><th scope=row>6</th><td>China      </td><td>2000</td><td>213766/1280428583</td></tr>
</tbody>
</table>


## separate


`separate` : êµ¬ë¶„ ë¬¸ìê°€ ë‚˜íƒ€ë‚˜ëŠ” ê³³ë§ˆë‹¤ ìª¼ê°œì„œ í•˜ë‚˜ì˜ ì—´ì„ ì—¬ëŸ¬ ì—´ë¡œ ë¶„ë¦¬<br>

ê¸°ë³¸ì ìœ¼ë¡œ `separate`ëŠ” ìˆ«ìë‚˜ ê¸€ìê°€ ì•„ë‹Œ ë¬¸ìë¥¼ ë³¼ ë•Œë§ˆë‹¤ ê°’ì„ ìª¼ê° ë‹¤.<br>

ì—´ì„ êµ¬ë¶„í•˜ëŠ” íŠ¹ì • ë¬¸ìë¥¼ ì½”ë“œì— ë‚˜íƒ€ë‚´ë ¤ë©´ `sep`ì„ ì‚¬ìš©í•œë‹¤.



```R
table3 %>%
separate(rate, into = c("cases", "population"))
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 4</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>cases</th><th scope=col>population</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>745   </td><td>19987071  </td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>2666  </td><td>20595360  </td></tr>
	<tr><td>Brazil     </td><td>1999</td><td>37737 </td><td>172006362 </td></tr>
	<tr><td>Brazil     </td><td>2000</td><td>80488 </td><td>174504898 </td></tr>
	<tr><td>China      </td><td>1999</td><td>212258</td><td>1272915272</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766</td><td>1280428583</td></tr>
</tbody>
</table>



```R
table3 %>%
separate(rate, into = c("cases", "population"), sep = "/")
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 4</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>cases</th><th scope=col>population</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>745   </td><td>19987071  </td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>2666  </td><td>20595360  </td></tr>
	<tr><td>Brazil     </td><td>1999</td><td>37737 </td><td>172006362 </td></tr>
	<tr><td>Brazil     </td><td>2000</td><td>80488 </td><td>174504898 </td></tr>
	<tr><td>China      </td><td>1999</td><td>212258</td><td>1272915272</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766</td><td>1280428583</td></tr>
</tbody>
</table>


- ê·¼ë° cases, population ë¬¸ìí˜• ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ ê²°ê³¼ê°€ characterë¡œ ë‚˜ì˜¨ë‹¤<br>

ì´ ë•Œ `convert` ì‚¬ìš©í•˜ë©´ ì í•©í•œ ì—´ì˜ ìœ í˜•ì„ ë³€í˜•í•´ì¤€ë‹¤.



```R
table3 %>%
separate(
    rate,
    into = c("cases", "population"),
    convert = TRUE
    )
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 4</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>cases</th><th scope=col>population</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>   745</td><td>  19987071</td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>  2666</td><td>  20595360</td></tr>
	<tr><td>Brazil     </td><td>1999</td><td> 37737</td><td> 172006362</td></tr>
	<tr><td>Brazil     </td><td>2000</td><td> 80488</td><td> 174504898</td></tr>
	<tr><td>China      </td><td>1999</td><td>212258</td><td>1272915272</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766</td><td>1280428583</td></tr>
</tbody>
</table>


- `sep`ì— ìˆ«ì ì…ë ¥í•˜ë©´ ì•ì—ì„œë¶€í„° ê·¸ ê°œìˆ˜ë§Œí¼ ì˜ë¼ì„œ ë¶„ë¦¬í•œë‹¤.(ìŒìˆ˜ëŠ” ë’¤ì—ì„œë¶€í„° ìë¦„)



```R
table3 %>%
separate(year, into = c("century", "year"), sep = 2)
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 4</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>century</th><th scope=col>year</th><th scope=col>rate</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>19</td><td>99</td><td>745/19987071     </td></tr>
	<tr><td>Afghanistan</td><td>20</td><td>00</td><td>2666/20595360    </td></tr>
	<tr><td>Brazil     </td><td>19</td><td>99</td><td>37737/172006362  </td></tr>
	<tr><td>Brazil     </td><td>20</td><td>00</td><td>80488/174504898  </td></tr>
	<tr><td>China      </td><td>19</td><td>99</td><td>212258/1272915272</td></tr>
	<tr><td>China      </td><td>20</td><td>00</td><td>213766/1280428583</td></tr>
</tbody>
</table>


`-` table5 ì˜ˆì œ



```R
table5
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 4</caption>
<thead>
	<tr><th></th><th scope=col>country</th><th scope=col>century</th><th scope=col>year</th><th scope=col>rate</th></tr>
	<tr><th></th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><th scope=row>1</th><td>Afghanistan</td><td>19</td><td>99</td><td>745/19987071     </td></tr>
	<tr><th scope=row>2</th><td>Afghanistan</td><td>20</td><td>00</td><td>2666/20595360    </td></tr>
	<tr><th scope=row>3</th><td>Brazil     </td><td>19</td><td>99</td><td>37737/172006362  </td></tr>
	<tr><th scope=row>4</th><td>Brazil     </td><td>20</td><td>00</td><td>80488/174504898  </td></tr>
	<tr><th scope=row>5</th><td>China      </td><td>19</td><td>99</td><td>212258/1272915272</td></tr>
	<tr><th scope=row>6</th><td>China      </td><td>20</td><td>00</td><td>213766/1280428583</td></tr>
</tbody>
</table>


## unite


`unite` : `separate`ê³¼ ë°˜ëŒ€ë¡œ ì—¬ëŸ¬ ì—´ì„ í•˜ë‚˜ì˜ ì—´ë¡œ ê²°í•©í•œë‹¤



```R
table5 %>%
unite(new, century, year)
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 3</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>new</th><th scope=col>rate</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>19_99</td><td>745/19987071     </td></tr>
	<tr><td>Afghanistan</td><td>20_00</td><td>2666/20595360    </td></tr>
	<tr><td>Brazil     </td><td>19_99</td><td>37737/172006362  </td></tr>
	<tr><td>Brazil     </td><td>20_00</td><td>80488/174504898  </td></tr>
	<tr><td>China      </td><td>19_99</td><td>212258/1272915272</td></tr>
	<tr><td>China      </td><td>20_00</td><td>213766/1280428583</td></tr>
</tbody>
</table>


- sep ì‚¬ìš©í•´ì„œ ë¶„ë¦¬ê¸°í˜¸ ë³€ê²½( `_` -> ê³µë°±)



```R
table5 %>%
unite(new, century, year, sep = "")
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 3</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>new</th><th scope=col>rate</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1999</td><td>745/19987071     </td></tr>
	<tr><td>Afghanistan</td><td>2000</td><td>2666/20595360    </td></tr>
	<tr><td>Brazil     </td><td>1999</td><td>37737/172006362  </td></tr>
	<tr><td>Brazil     </td><td>2000</td><td>80488/174504898  </td></tr>
	<tr><td>China      </td><td>1999</td><td>212258/1272915272</td></tr>
	<tr><td>China      </td><td>2000</td><td>213766/1280428583</td></tr>
</tbody>
</table>


## ê²°ì¸¡ê°’


> - ë°ì´í„°ê°’ì€ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ê²°ì¸¡ë  ìˆ˜ ìˆë‹¤.<br>

> 1) ëª…ì‹œì ìœ¼ë¡œ, ì¦‰ NAë¡œ í‘œì‹œëœë‹¤.<br>

> 2) ì•”ë¬µì ìœ¼ë¡œ, ì¦‰ ë‹¨ìˆœíˆ ë°ì´í„°ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.(ì´ëŸ°ê±° ë‹¨ìˆœíˆ 0ìœ¼ë¡œ ë†“ê³ ê°€ë©´ ë¬¸ì œ ìƒê¹€)


`-` ì˜ˆì‹œ ë§Œë“¤ê¸°



```R
stocks <- tibble(
    year = c(2015, 2015, 2015, 2015, 2016, 2016, 2016),
    qtr = c(1, 2, 3, 4, 2, 3, 4),
    return = c(1.88, 0.59, 0.35, NA, 0.92, 0.17, 2.66)
    )
```


```R
stocks
```

<table class="dataframe">
<caption>A tibble: 7 Ã— 3</caption>
<thead>
	<tr><th scope=col>year</th><th scope=col>qtr</th><th scope=col>return</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>2015</td><td>1</td><td>1.88</td></tr>
	<tr><td>2015</td><td>2</td><td>0.59</td></tr>
	<tr><td>2015</td><td>3</td><td>0.35</td></tr>
	<tr><td>2015</td><td>4</td><td>  NA</td></tr>
	<tr><td>2016</td><td>2</td><td>0.92</td></tr>
	<tr><td>2016</td><td>3</td><td>0.17</td></tr>
	<tr><td>2016</td><td>4</td><td>2.66</td></tr>
</tbody>
</table>


- NAë¿ë§Œ ì•„ë‹ˆë¼ 2016ë…„ 1ë¶„ê¸°ë„ ê²°ì¸¡ê°’ì„<br>

ì•„ë˜ëŠ” ë°ì´í„° ì…‹ í‘œí˜„ë²•ìœ¼ë¡œ ì•”ë¬µì  ê²°ì¸¡ê°’ì„ ëª…ì‹œì  ê²°ì¸¡ê°’(NA)ë¡œ ë‚˜íƒ€ë‚´ì¤€ ëª¨ìŠµ



```R
stocks %>%
pivot_wider(names_from = year, values_from = return)
```

<table class="dataframe">
<caption>A tibble: 4 Ã— 3</caption>
<thead>
	<tr><th scope=col>qtr</th><th scope=col>2015</th><th scope=col>2016</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>1.88</td><td>  NA</td></tr>
	<tr><td>2</td><td>0.59</td><td>0.92</td></tr>
	<tr><td>3</td><td>0.35</td><td>0.17</td></tr>
	<tr><td>4</td><td>  NA</td><td>2.66</td></tr>
</tbody>
</table>


`values_drop_na = TRUE` : `pivot_longer`ì—ì„œ ëª…ì‹œì  ê²°ì¸¡ê°’ì„ ì•”ë¬µì  ê²°ì¸¡ê°’ìœ¼ë¡œ ì „í™˜(ìœ„ì—ì„œëŠ” í‘œì‹œí•´ì¤¬ëŠ”ë° ì˜¤íˆë ¤ í•„ìš”ê°€ ì—†ëŠ” ê²½ìš°ëŠ” ì´ë ‡ê²Œ)



```R
stocks %>%
pivot_wider(names_from = year, values_from = return) %>%
pivot_longer(
    col = c('2015', '2016'),
    names_to = "year",
    values_to = "return",
    values_drop_na = TRUE
    )
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 3</caption>
<thead>
	<tr><th scope=col>qtr</th><th scope=col>year</th><th scope=col>return</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2015</td><td>1.88</td></tr>
	<tr><td>2</td><td>2015</td><td>0.59</td></tr>
	<tr><td>2</td><td>2016</td><td>0.92</td></tr>
	<tr><td>3</td><td>2015</td><td>0.35</td></tr>
	<tr><td>3</td><td>2016</td><td>0.17</td></tr>
	<tr><td>4</td><td>2016</td><td>2.66</td></tr>
</tbody>
</table>


`complete` : ì—´ ì§‘í•©ì„ ì…ë ¥ìœ¼ë¡œ í•˜ì—¬ ê±°ê¸°ì— ë§ëŠ” ì¡°í•©í–‰ì„ ì­‰ ë‚˜ì—´, ì´ë•Œ ë¹„ì–´ ìˆëŠ” ë°ì´í„°ì˜ ê²½ìš° NAë¡œ í‘œì‹œ



```R
stocks %>%
complete(year, qtr)
```

<table class="dataframe">
<caption>A tibble: 8 Ã— 3</caption>
<thead>
	<tr><th scope=col>year</th><th scope=col>qtr</th><th scope=col>return</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>2015</td><td>1</td><td>1.88</td></tr>
	<tr><td>2015</td><td>2</td><td>0.59</td></tr>
	<tr><td>2015</td><td>3</td><td>0.35</td></tr>
	<tr><td>2015</td><td>4</td><td>  NA</td></tr>
	<tr><td>2016</td><td>1</td><td>  NA</td></tr>
	<tr><td>2016</td><td>2</td><td>0.92</td></tr>
	<tr><td>2016</td><td>3</td><td>0.17</td></tr>
	<tr><td>2016</td><td>4</td><td>2.66</td></tr>
</tbody>
</table>



```R
treatment <- tribble(
    ~person,           ~treatment, ~response,
    "Derrick Whitmore",1,          7,
    NA,                2,          10,
    NA,                3,          9,
    "Katherine Burke", 1,          4
    )
```


```R
treatment
```

<table class="dataframe">
<caption>A tibble: 4 Ã— 3</caption>
<thead>
	<tr><th scope=col>person</th><th scope=col>treatment</th><th scope=col>response</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Derrick Whitmore</td><td>1</td><td> 7</td></tr>
	<tr><td>NA              </td><td>2</td><td>10</td></tr>
	<tr><td>NA              </td><td>3</td><td> 9</td></tr>
	<tr><td>Katherine Burke </td><td>1</td><td> 4</td></tr>
</tbody>
</table>


`fill` : ê²°ì¸¡ê°’ì„ ê°€ì¥ ìµœê·¼ì˜ ë¹„ê²°ì¸¡ê°’ìœ¼ë¡œ ì±„ì›€



```R
treatment %>%
fill(person)
```

<table class="dataframe">
<caption>A tibble: 4 Ã— 3</caption>
<thead>
	<tr><th scope=col>person</th><th scope=col>treatment</th><th scope=col>response</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Derrick Whitmore</td><td>1</td><td> 7</td></tr>
	<tr><td>Derrick Whitmore</td><td>2</td><td>10</td></tr>
	<tr><td>Derrick Whitmore</td><td>3</td><td> 9</td></tr>
	<tr><td>Katherine Burke </td><td>1</td><td> 4</td></tr>
</tbody>
</table>


## ê²°í•µì‚¬ë¡€ ì—°êµ¬


`-` whoë°ì´í„° ì‚¬ìš©



```R
who %>% head
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 60</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>iso2</th><th scope=col>iso3</th><th scope=col>year</th><th scope=col>new_sp_m014</th><th scope=col>new_sp_m1524</th><th scope=col>new_sp_m2534</th><th scope=col>new_sp_m3544</th><th scope=col>new_sp_m4554</th><th scope=col>new_sp_m5564</th><th scope=col>â‹¯</th><th scope=col>newrel_m4554</th><th scope=col>newrel_m5564</th><th scope=col>newrel_m65</th><th scope=col>newrel_f014</th><th scope=col>newrel_f1524</th><th scope=col>newrel_f2534</th><th scope=col>newrel_f3544</th><th scope=col>newrel_f4554</th><th scope=col>newrel_f5564</th><th scope=col>newrel_f65</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>â‹¯</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1980</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>â‹¯</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1981</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>â‹¯</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1982</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>â‹¯</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1983</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>â‹¯</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1984</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>â‹¯</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1985</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>â‹¯</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td><td>NA</td></tr>
</tbody>
</table>


- ë°ì´í„°ì…‹ì´ êµ‰ì¥íˆ ë³µì¡í•˜ë‹¤<br>

ë³´í†µ ì´ëŸ´ ë•Œì—ëŠ” ë³€ìˆ˜ê°€ ì•„ë‹Œ ì—´ì„ ëª¨ìœ¼ëŠ” ê²ƒë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.<br>

country, iso2, iso3ëŠ” êµ­ê°€ë¥¼ ì¤‘ë³µí•´ì„œ ì§€ì •í•˜ëŠ” ì„¸ê°œì˜ ë³€ìˆ˜ì´ë‹¤.<br>

year ë˜ ë¶„ëª…íˆ ë³€ìˆ˜ì´ë‹¤.<br>

ë‹¤ë¥¸ ëª¨ë“  ì—´ì€ ì•„ì§ ë¬´ì—‡ì¸ì§€ ì•Œ ìˆ˜ ì—†ì§€ë§Œ ë³€ìˆ˜ ì´ë¦„(new_sp_m014ë“±ë“±)ì˜ êµ¬ì¡°ë¥¼ ë³´ë©´ ì´ë“¤ì€ ë³€ìˆ˜ê°€ ì•„ë‹ˆë¼ ê°’ì¸ ê²ƒ ê°™ë‹¤.<br>

ê·¸ë˜ì„œ new_sp_m014ë“¤ì€ ê°’ìœ¼ë¡œ ì·¨ê¸‰í•˜ì—¬ ë¬¶ì–´ì„œ í–‰ìœ¼ë¡œ ë³´ë‚´ê³  í™•ì‹¤í•œ ë³€ìˆ˜ë“¤ì„ ì—´ì— ë‘”ë‹¤.



```R
who1 <- who %>%
pivot_longer(
    cols = new_sp_m014:newrel_f65,
    names_to = "key",
    values_to = "cases",
    values_drop_na = TRUE
    )
who1 %>% head
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>iso2</th><th scope=col>iso3</th><th scope=col>year</th><th scope=col>key</th><th scope=col>cases</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m014 </td><td> 0</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m1524</td><td>10</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m2534</td><td> 6</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m3544</td><td> 3</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m4554</td><td> 5</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m5564</td><td> 2</td></tr>
</tbody>
</table>


`-` ìƒˆë¡œìš´ keyì—´ì˜ ê°’ì„ ì„¸ì–´ì„œ êµ¬ì¡°ì— ëŒ€í•œ íŒíŠ¸ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤



```R
who1 %>%
count(key) 
```

<table class="dataframe">
<caption>A tibble: 56 Ã— 2</caption>
<thead>
	<tr><th scope=col>key</th><th scope=col>n</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>new_ep_f014 </td><td>1032</td></tr>
	<tr><td>new_ep_f1524</td><td>1021</td></tr>
	<tr><td>new_ep_f2534</td><td>1021</td></tr>
	<tr><td>new_ep_f3544</td><td>1021</td></tr>
	<tr><td>new_ep_f4554</td><td>1017</td></tr>
	<tr><td>new_ep_f5564</td><td>1017</td></tr>
	<tr><td>new_ep_f65  </td><td>1014</td></tr>
	<tr><td>new_ep_m014 </td><td>1038</td></tr>
	<tr><td>new_ep_m1524</td><td>1026</td></tr>
	<tr><td>new_ep_m2534</td><td>1020</td></tr>
	<tr><td>new_ep_m3544</td><td>1024</td></tr>
	<tr><td>new_ep_m4554</td><td>1020</td></tr>
	<tr><td>new_ep_m5564</td><td>1015</td></tr>
	<tr><td>new_ep_m65  </td><td>1018</td></tr>
	<tr><td>new_sn_f014 </td><td>1040</td></tr>
	<tr><td>new_sn_f1524</td><td>1022</td></tr>
	<tr><td>new_sn_f2534</td><td>1016</td></tr>
	<tr><td>new_sn_f3544</td><td>1020</td></tr>
	<tr><td>new_sn_f4554</td><td>1018</td></tr>
	<tr><td>new_sn_f5564</td><td>1017</td></tr>
	<tr><td>new_sn_f65  </td><td>1019</td></tr>
	<tr><td>new_sn_m014 </td><td>1045</td></tr>
	<tr><td>new_sn_m1524</td><td>1030</td></tr>
	<tr><td>new_sn_m2534</td><td>1022</td></tr>
	<tr><td>new_sn_m3544</td><td>1025</td></tr>
	<tr><td>new_sn_m4554</td><td>1027</td></tr>
	<tr><td>new_sn_m5564</td><td>1021</td></tr>
	<tr><td>new_sn_m65  </td><td>1020</td></tr>
	<tr><td>new_sp_f014 </td><td>3174</td></tr>
	<tr><td>new_sp_f1524</td><td>3194</td></tr>
	<tr><td>new_sp_f2534</td><td>3200</td></tr>
	<tr><td>new_sp_f3544</td><td>3199</td></tr>
	<tr><td>new_sp_f4554</td><td>3204</td></tr>
	<tr><td>new_sp_f5564</td><td>3195</td></tr>
	<tr><td>new_sp_f65  </td><td>3197</td></tr>
	<tr><td>new_sp_m014 </td><td>3173</td></tr>
	<tr><td>new_sp_m1524</td><td>3209</td></tr>
	<tr><td>new_sp_m2534</td><td>3206</td></tr>
	<tr><td>new_sp_m3544</td><td>3219</td></tr>
	<tr><td>new_sp_m4554</td><td>3223</td></tr>
	<tr><td>new_sp_m5564</td><td>3218</td></tr>
	<tr><td>new_sp_m65  </td><td>3209</td></tr>
	<tr><td>newrel_f014 </td><td> 190</td></tr>
	<tr><td>newrel_f1524</td><td> 184</td></tr>
	<tr><td>newrel_f2534</td><td> 182</td></tr>
	<tr><td>newrel_f3544</td><td> 183</td></tr>
	<tr><td>newrel_f4554</td><td> 183</td></tr>
	<tr><td>newrel_f5564</td><td> 183</td></tr>
	<tr><td>newrel_f65  </td><td> 185</td></tr>
	<tr><td>newrel_m014 </td><td> 190</td></tr>
	<tr><td>newrel_m1524</td><td> 182</td></tr>
	<tr><td>newrel_m2534</td><td> 183</td></tr>
	<tr><td>newrel_m3544</td><td> 184</td></tr>
	<tr><td>newrel_m4554</td><td> 184</td></tr>
	<tr><td>newrel_m5564</td><td> 185</td></tr>
	<tr><td>newrel_m65  </td><td> 182</td></tr>
</tbody>
</table>


ì•„ë˜ëŠ” ë°ì´í„° ì‚¬ì „(?)ì„ ì‚¬ìš©í•˜ë©´ ì•Œë ¤ì¤€ë‹¤ëŠ”ë°..?


> relì€ ì¬ë°œ ì‚¬ë¡€ë¥¼ ì˜ë¯¸<br>

epëŠ” íì™¸ ê²°í•µ ì‚¬ë¡€ë¥¼ ì˜ë¯¸<br>

snì€ í ì–¼ë£©ìœ¼ë¡œ ë³´ì´ì§€ ì•ŠëŠ” íê²°í•µì˜ ì‚¬ë¡€ë¥¼ ì˜ë¯¸<br>

spëŠ” í ì–¼ë£©ìœ¼ë¡œ ë³´ì´ëŠ” íê²°í•µ ì‚¬ë¡€ë¥¼ ì˜ë¯¸<br>

<br>

ì—¬ì„¯ ë²ˆì§¸ëŠ” ì„±ë³„<br>

ë‚˜ë¨¸ì§€ ìˆ«ìëŠ” ì—°ë ¹ëŒ€ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.<br>

014 -> 0~14ì„¸<br>

.<br>

.<br>

.<br>

65 -> 65ì„¸ ì´ìƒ


ë”°ë¼ì„œ ì—´ ì´ë¦„ì˜ í˜•ì‹ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤<br>

new_relì´ ì•„ë‹ˆë¼ newrel ì´ëŸ°ì‹ì´ê¸°ì—<br>

`str_replace`ëŠ” ì°¨í›„ì— ìì„¸íˆ ì„¤ëª…í•¨



```R
who2 <- who1 %>%
mutate(key = stringr::str_replace(key, "newrel", "new_rel"))
who2 %>% head
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>iso2</th><th scope=col>iso3</th><th scope=col>year</th><th scope=col>key</th><th scope=col>cases</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m014 </td><td> 0</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m1524</td><td>10</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m2534</td><td> 6</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m3544</td><td> 3</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m4554</td><td> 5</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new_sp_m5564</td><td> 2</td></tr>
</tbody>
</table>


- ìœ„ì—ì„œ ì´ë¦„ ì‚¬ì´ì— `_`ë¥¼ ë„£ì—ˆë˜ ê²ƒì€ ë¶„ë¦¬í•˜ê¸° ìœ„í•¨ì´ì˜€ë‹¤.



```R
who3 <- who2 %>%
separate(key, c("new", "type", "sexage"), sep = "_")
who3 %>% head
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 8</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>iso2</th><th scope=col>iso3</th><th scope=col>year</th><th scope=col>new</th><th scope=col>type</th><th scope=col>sexage</th><th scope=col>cases</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new</td><td>sp</td><td>m014 </td><td> 0</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new</td><td>sp</td><td>m1524</td><td>10</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new</td><td>sp</td><td>m2534</td><td> 6</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new</td><td>sp</td><td>m3544</td><td> 3</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new</td><td>sp</td><td>m4554</td><td> 5</td></tr>
	<tr><td>Afghanistan</td><td>AF</td><td>AFG</td><td>1997</td><td>new</td><td>sp</td><td>m5564</td><td> 2</td></tr>
</tbody>
</table>


- newì—´ì€ ìƒìˆ˜ì´ë¯€ë¡œ ì œê±°í•œë‹¤, iso2, iso3ë„ ì¤‘ë³µì´ë¯€ë¡œ ì œê±°í•œë‹¤.


`select` : -ë¡œ í•˜ë©´ ê·¸ê±° ë¹¼ê³  ì¶œë ¥í•´ì¤€ë‹¤



```R
who4 <- who3 %>%
select(-new, -iso2, -iso3)
```


```R
who4 %>% head
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 5</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>type</th><th scope=col>sexage</th><th scope=col>cases</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m014 </td><td> 0</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m1524</td><td>10</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m2534</td><td> 6</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m3544</td><td> 3</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m4554</td><td> 5</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m5564</td><td> 2</td></tr>
</tbody>
</table>



```R
who5 <- who4 %>%
separate(sexage, c("sex", "age"), sep = 1)
```


```R
who5 %>% head
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>type</th><th scope=col>sex</th><th scope=col>age</th><th scope=col>cases</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>014 </td><td> 0</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>1524</td><td>10</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>2534</td><td> 6</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>3544</td><td> 3</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>4554</td><td> 5</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>5564</td><td> 2</td></tr>
</tbody>
</table>


ì´ ì •ë„ë©´ whoë°ì´í„°ì…‹ì€ ìµœëŒ€í•œ tidyí•˜ê²Œ ë§Œë“¦.


`-` ìœ„ì—ì„œ ì°¨ë¡€ë¡œ í•´ì˜¨ ê²ƒê³¼ ê°™ì€ ë°©ì‹ì¸ë° í•œë²ˆì— ì •ë¦¬í•˜ê¸°



```R
who %>%
pivot_longer(
    cols = new_sp_m014:newrel_f65,
    names_to = "key",
    values_to = "cases",
    values_drop_na = TRUE

    ) %>%
mutate(
    key = stringr::str_replace(key, "newrel","new_rel")
    ) %>%
separate(key, c("new", "var", "sexage")) %>%
select(-new, -iso2, -iso3) %>%
separate(sexage, c("sex", "age"), sep = 1) %>% head
```

<table class="dataframe">
<caption>A tibble: 6 Ã— 6</caption>
<thead>
	<tr><th scope=col>country</th><th scope=col>year</th><th scope=col>var</th><th scope=col>sex</th><th scope=col>age</th><th scope=col>cases</th></tr>
	<tr><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;chr&gt;</th><th scope=col>&lt;int&gt;</th></tr>
</thead>
<tbody>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>014 </td><td> 0</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>1524</td><td>10</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>2534</td><td> 6</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>3544</td><td> 3</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>4554</td><td> 5</td></tr>
	<tr><td>Afghanistan</td><td>1997</td><td>sp</td><td>m</td><td>5564</td><td> 2</td></tr>
</tbody>
</table>



```R
```
